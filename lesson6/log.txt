## Устанавливаем указанные в методичке пакеты и неуказанный gcc
yum install -y redhat-lsb-core wget rpmdevtools rpm-build createrepo yum-utils gcc
Вывод yum неинтересен.

## Скачиваем ираспаковываем  nginx

[root@kernel-update vagrant]# wget https://nginx.org/packages/centos/7/SRPMS/nginx-1.14.1-1.el7_4.ngx.src.rpm
--2021-05-28 14:57:32--  https://nginx.org/packages/centos/7/SRPMS/nginx-1.14.1-1.el7_4.ngx.src.rpm
Resolving nginx.org (nginx.org)... 3.125.197.172, 52.58.199.22, 2a05:d014:edb:5702::6, ...
Connecting to nginx.org (nginx.org)|3.125.197.172|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1033399 (1009K) [application/x-redhat-package-manager]
Saving to: 'nginx-1.14.1-1.el7_4.ngx.src.rpm'

100%[===================================================================================================================================================================================================>] 1,033,399   2.92MB/s   in 0.3s

2021-05-28 14:57:33 (2.92 MB/s) - 'nginx-1.14.1-1.el7_4.ngx.src.rpm' saved [1033399/1033399]

[root@kernel-update vagrant]#  rpm -i nginx-1.14.1-1.el7_4.ngx.src.rpm
warning: nginx-1.14.1-1.el7_4.ngx.src.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
warning: user builder does not exist - using root
warning: group builder does not exist - using root
[root@kernel-update vagrant]# ls -lah
total 1.0M
drwx------. 3 vagrant vagrant   114 May 28 14:57 .
drwxr-xr-x. 3 root    root       21 Apr 30  2020 ..
-rw-r--r--. 1 vagrant vagrant    18 Apr  1  2020 .bash_logout
-rw-r--r--. 1 vagrant vagrant   193 Apr  1  2020 .bash_profile
-rw-r--r--. 1 vagrant vagrant   231 Apr  1  2020 .bashrc
drwx------. 2 vagrant vagrant    29 May 28 14:55 .ssh
-rw-r--r--. 1 root    root    1010K Nov  6  2018 nginx-1.14.1-1.el7_4.ngx.src.rpm
[root@kernel-update vagrant]# cd /root
[root@kernel-update ~]# ls -la
total 36
dr-xr-x---.  3 root root  153 May 28 14:57 .
dr-xr-xr-x. 17 root root  240 Apr 30  2020 ..
-rw-r--r--.  1 root root   18 Dec 29  2013 .bash_logout
-rw-r--r--.  1 root root  176 Dec 29  2013 .bash_profile
-rw-r--r--.  1 root root  176 Dec 29  2013 .bashrc
-rw-r--r--.  1 root root  100 Dec 29  2013 .cshrc
-rw-r--r--.  1 root root  129 Dec 29  2013 .tcshrc
-rw-------.  1 root root 5570 Apr 30  2020 anaconda-ks.cfg
-rw-------.  1 root root 5300 Apr 30  2020 original-ks.cfg
drwxr-xr-x.  4 root root   34 May 28 14:57 rpmbuild
[root@kernel-update ~]#

## Скачиваем и распаковываем openssl

[root@kernel-update ~]# wget https://www.openssl.org/source/latest.tar.gz
--2021-05-28 15:00:08--  https://www.openssl.org/source/latest.tar.gz
Resolving www.openssl.org (www.openssl.org)... 96.6.15.114, 2a02:26f0:41:688::c1e, 2a02:26f0:41:681::c1e
Connecting to www.openssl.org (www.openssl.org)|96.6.15.114|:443... connected.
HTTP request sent, awaiting response... 302 Moved Temporarily
Location: https://www.openssl.org/source/openssl-1.1.1k.tar.gz [following]
--2021-05-28 15:00:08--  https://www.openssl.org/source/openssl-1.1.1k.tar.gz
Reusing existing connection to www.openssl.org:443.
HTTP request sent, awaiting response... 200 OK
Length: 9823400 (9.4M) [application/x-gzip]
Saving to: 'latest.tar.gz'

100%[===================================================================================================================================================================================================>] 9,823,400   12.7MB/s   in 0.7s

2021-05-28 15:00:09 (12.7 MB/s) - 'latest.tar.gz' saved [9823400/9823400]

[root@kernel-update ~]#

[root@kernel-update ~]#  tar -xvf latest.tar.gz|more
openssl-1.1.1k/
[skipped]
openssl-1.1.1k/util/unlocal_shlib.com.in
[root@kernel-update ~]#

## Устанавливаем зависимости из nginx.spec

[root@kernel-update ~]# yum-builddep rpmbuild/SPECS/nginx.spec
Loaded plugins: fastestmirror
Enabling base-source repository
Enabling extras-source repository
Enabling updates-source repository
Loading mirror speeds from cached hostfile
 * base: mirror.logol.ru
 * extras: mirror.axelname.ru
 * updates: mirror.logol.ru
Checking for new repos for mirrors
Getting requirements for rpmbuild/SPECS/nginx.spec
 --> Already installed : redhat-lsb-core-4.1-27.el7.centos.1.x86_64
 --> Already installed : systemd-219-73.el7_8.5.x86_64
 --> 1:openssl-devel-1.0.2k-21.el7_9.x86_64
 --> zlib-devel-1.2.7-19.el7_9.x86_64
 --> pcre-devel-8.32-17.el7.x86_64
--> Running transaction check
---> Package openssl-devel.x86_64 1:1.0.2k-21.el7_9 will be installed
--> Processing Dependency: openssl-libs(x86-64) = 1:1.0.2k-21.el7_9 for package: 1:openssl-devel-1.0.2k-21.el7_9.x86_64
--> Processing Dependency: krb5-devel(x86-64) for package: 1:openssl-devel-1.0.2k-21.el7_9.x86_64
---> Package pcre-devel.x86_64 0:8.32-17.el7 will be installed
---> Package zlib-devel.x86_64 0:1.2.7-19.el7_9 will be installed
--> Processing Dependency: zlib = 1.2.7-19.el7_9 for package: zlib-devel-1.2.7-19.el7_9.x86_64
Package: zlib-1.2.7-19.el7_9.src - can't co-install with zlib-1.2.7-19.el7_9.x86_64
Package: zlib-1.2.7-19.el7_9.src - can't co-install with zlib-1.2.7-19.el7_9.x86_64
--> Running transaction check
---> Package krb5-devel.x86_64 0:1.15.1-50.el7 will be installed
--> Processing Dependency: libkadm5(x86-64) = 1.15.1-50.el7 for package: krb5-devel-1.15.1-50.el7.x86_64
--> Processing Dependency: krb5-libs(x86-64) = 1.15.1-50.el7 for package: krb5-devel-1.15.1-50.el7.x86_64
--> Processing Dependency: libverto-devel for package: krb5-devel-1.15.1-50.el7.x86_64
--> Processing Dependency: libselinux-devel for package: krb5-devel-1.15.1-50.el7.x86_64
--> Processing Dependency: libcom_err-devel for package: krb5-devel-1.15.1-50.el7.x86_64
--> Processing Dependency: keyutils-libs-devel for package: krb5-devel-1.15.1-50.el7.x86_64
---> Package openssl-libs.x86_64 1:1.0.2k-19.el7 will be updated
--> Processing Dependency: openssl-libs(x86-64) = 1:1.0.2k-19.el7 for package: 1:openssl-1.0.2k-19.el7.x86_64
---> Package openssl-libs.x86_64 1:1.0.2k-21.el7_9 will be an update
---> Package zlib.x86_64 0:1.2.7-18.el7 will be updated
---> Package zlib.x86_64 0:1.2.7-19.el7_9 will be an update
--> Running transaction check
---> Package keyutils-libs-devel.x86_64 0:1.5.8-3.el7 will be installed
---> Package krb5-libs.x86_64 0:1.15.1-46.el7 will be updated
---> Package krb5-libs.x86_64 0:1.15.1-50.el7 will be an update
---> Package libcom_err-devel.x86_64 0:1.42.9-19.el7 will be installed
--> Processing Dependency: libcom_err(x86-64) = 1.42.9-19.el7 for package: libcom_err-devel-1.42.9-19.el7.x86_64
---> Package libkadm5.x86_64 0:1.15.1-50.el7 will be installed
---> Package libselinux-devel.x86_64 0:2.5-15.el7 will be installed
--> Processing Dependency: libsepol-devel(x86-64) >= 2.5-10 for package: libselinux-devel-2.5-15.el7.x86_64
--> Processing Dependency: pkgconfig(libsepol) for package: libselinux-devel-2.5-15.el7.x86_64
---> Package libverto-devel.x86_64 0:0.2.5-4.el7 will be installed
---> Package openssl.x86_64 1:1.0.2k-19.el7 will be updated
---> Package openssl.x86_64 1:1.0.2k-21.el7_9 will be an update
--> Running transaction check
---> Package libcom_err.x86_64 0:1.42.9-17.el7 will be updated
--> Processing Dependency: libcom_err(x86-64) = 1.42.9-17.el7 for package: e2fsprogs-libs-1.42.9-17.el7.x86_64
--> Processing Dependency: libcom_err(x86-64) = 1.42.9-17.el7 for package: e2fsprogs-1.42.9-17.el7.x86_64
--> Processing Dependency: libcom_err(x86-64) = 1.42.9-17.el7 for package: libss-1.42.9-17.el7.x86_64
---> Package libcom_err.x86_64 0:1.42.9-19.el7 will be an update
---> Package libsepol-devel.x86_64 0:2.5-10.el7 will be installed
--> Running transaction check
---> Package e2fsprogs.x86_64 0:1.42.9-17.el7 will be updated
---> Package e2fsprogs.x86_64 0:1.42.9-19.el7 will be an update
---> Package e2fsprogs-libs.x86_64 0:1.42.9-17.el7 will be updated
---> Package e2fsprogs-libs.x86_64 0:1.42.9-19.el7 will be an update
---> Package libss.x86_64 0:1.42.9-17.el7 will be updated
---> Package libss.x86_64 0:1.42.9-19.el7 will be an update
--> Finished Dependency Resolution

Dependencies Resolved

=============================================================================================================================================================================================================================================
 Package                                                         Arch                                               Version                                                        Repository                                           Size
=============================================================================================================================================================================================================================================
Installing:
 openssl-devel                                                   x86_64                                             1:1.0.2k-21.el7_9                                              updates                                             1.5 M
 pcre-devel                                                      x86_64                                             8.32-17.el7                                                    base                                                480 k
 zlib-devel                                                      x86_64                                             1.2.7-19.el7_9                                                 updates                                              50 k
Installing for dependencies:
 keyutils-libs-devel                                             x86_64                                             1.5.8-3.el7                                                    base                                                 37 k
 krb5-devel                                                      x86_64                                             1.15.1-50.el7                                                  base                                                273 k
 libcom_err-devel                                                x86_64                                             1.42.9-19.el7                                                  base                                                 32 k
 libkadm5                                                        x86_64                                             1.15.1-50.el7                                                  base                                                179 k
 libselinux-devel                                                x86_64                                             2.5-15.el7                                                     base                                                187 k
 libsepol-devel                                                  x86_64                                             2.5-10.el7                                                     base                                                 77 k
 libverto-devel                                                  x86_64                                             0.2.5-4.el7                                                    base                                                 12 k
Updating for dependencies:
 e2fsprogs                                                       x86_64                                             1.42.9-19.el7                                                  base                                                701 k
 e2fsprogs-libs                                                  x86_64                                             1.42.9-19.el7                                                  base                                                168 k
 krb5-libs                                                       x86_64                                             1.15.1-50.el7                                                  base                                                809 k
 libcom_err                                                      x86_64                                             1.42.9-19.el7                                                  base                                                 42 k
 libss                                                           x86_64                                             1.42.9-19.el7                                                  base                                                 47 k
 openssl                                                         x86_64                                             1:1.0.2k-21.el7_9                                              updates                                             493 k
 openssl-libs                                                    x86_64                                             1:1.0.2k-21.el7_9                                              updates                                             1.2 M
 zlib                                                            x86_64                                             1.2.7-19.el7_9                                                 updates                                              90 k

Transaction Summary
=============================================================================================================================================================================================================================================
Install  3 Packages (+7 Dependent packages)
Upgrade             ( 8 Dependent packages)

Total download size: 6.3 M
Is this ok [y/d/N]: y
Downloading packages:
No Presto metadata available for base
No Presto metadata available for updates
(1/18): keyutils-libs-devel-1.5.8-3.el7.x86_64.rpm                                                                                                                                                                    |  37 kB  00:00:00
(2/18): e2fsprogs-1.42.9-19.el7.x86_64.rpm                                                                                                                                                                            | 701 kB  00:00:00
(3/18): e2fsprogs-libs-1.42.9-19.el7.x86_64.rpm                                                                                                                                                                       | 168 kB  00:00:00
(4/18): libcom_err-1.42.9-19.el7.x86_64.rpm                                                                                                                                                                           |  42 kB  00:00:00
(5/18): krb5-devel-1.15.1-50.el7.x86_64.rpm                                                                                                                                                                           | 273 kB  00:00:00
(6/18): libcom_err-devel-1.42.9-19.el7.x86_64.rpm                                                                                                                                                                     |  32 kB  00:00:00
(7/18): libkadm5-1.15.1-50.el7.x86_64.rpm                                                                                                                                                                             | 179 kB  00:00:00
(8/18): libsepol-devel-2.5-10.el7.x86_64.rpm                                                                                                                                                                          |  77 kB  00:00:00
(9/18): libselinux-devel-2.5-15.el7.x86_64.rpm                                                                                                                                                                        | 187 kB  00:00:00
(10/18): libss-1.42.9-19.el7.x86_64.rpm                                                                                                                                                                               |  47 kB  00:00:00
(11/18): libverto-devel-0.2.5-4.el7.x86_64.rpm                                                                                                                                                                        |  12 kB  00:00:00
(12/18): krb5-libs-1.15.1-50.el7.x86_64.rpm                                                                                                                                                                           | 809 kB  00:00:00
(13/18): openssl-libs-1.0.2k-21.el7_9.x86_64.rpm                                                                                                                                                                      | 1.2 MB  00:00:00
(14/18): zlib-1.2.7-19.el7_9.x86_64.rpm                                                                                                                                                                               |  90 kB  00:00:00
(15/18): zlib-devel-1.2.7-19.el7_9.x86_64.rpm                                                                                                                                                                         |  50 kB  00:00:00
(16/18): openssl-1.0.2k-21.el7_9.x86_64.rpm                                                                                                                                                                           | 493 kB  00:00:00
(17/18): pcre-devel-8.32-17.el7.x86_64.rpm                                                                                                                                                                            | 480 kB  00:00:00
(18/18): openssl-devel-1.0.2k-21.el7_9.x86_64.rpm                                                                                                                                                                     | 1.5 MB  00:00:00
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                                                                                        4.0 MB/s | 6.3 MB  00:00:01
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Updating   : libcom_err-1.42.9-19.el7.x86_64                                                                                                                                                                                          1/26
  Updating   : zlib-1.2.7-19.el7_9.x86_64                                                                                                                                                                                               2/26
  Updating   : krb5-libs-1.15.1-50.el7.x86_64                                                                                                                                                                                           3/26
  Updating   : 1:openssl-libs-1.0.2k-21.el7_9.x86_64                                                                                                                                                                                    4/26
  Installing : libkadm5-1.15.1-50.el7.x86_64                                                                                                                                                                                            5/26
  Installing : zlib-devel-1.2.7-19.el7_9.x86_64                                                                                                                                                                                         6/26
  Updating   : e2fsprogs-libs-1.42.9-19.el7.x86_64                                                                                                                                                                                      7/26
  Updating   : libss-1.42.9-19.el7.x86_64                                                                                                                                                                                               8/26
  Installing : libcom_err-devel-1.42.9-19.el7.x86_64                                                                                                                                                                                    9/26
  Installing : libsepol-devel-2.5-10.el7.x86_64                                                                                                                                                                                        10/26
  Installing : libverto-devel-0.2.5-4.el7.x86_64                                                                                                                                                                                       11/26
  Installing : pcre-devel-8.32-17.el7.x86_64                                                                                                                                                                                           12/26
  Installing : libselinux-devel-2.5-15.el7.x86_64                                                                                                                                                                                      13/26
  Installing : keyutils-libs-devel-1.5.8-3.el7.x86_64                                                                                                                                                                                  14/26
  Installing : krb5-devel-1.15.1-50.el7.x86_64                                                                                                                                                                                         15/26
  Installing : 1:openssl-devel-1.0.2k-21.el7_9.x86_64                                                                                                                                                                                  16/26
  Updating   : e2fsprogs-1.42.9-19.el7.x86_64                                                                                                                                                                                          17/26
  Updating   : 1:openssl-1.0.2k-21.el7_9.x86_64                                                                                                                                                                                        18/26
  Cleanup    : 1:openssl-1.0.2k-19.el7.x86_64                                                                                                                                                                                          19/26
  Cleanup    : e2fsprogs-1.42.9-17.el7.x86_64                                                                                                                                                                                          20/26
  Cleanup    : krb5-libs-1.15.1-46.el7.x86_64                                                                                                                                                                                          21/26
  Cleanup    : 1:openssl-libs-1.0.2k-19.el7.x86_64                                                                                                                                                                                     22/26
  Cleanup    : e2fsprogs-libs-1.42.9-17.el7.x86_64                                                                                                                                                                                     23/26
  Cleanup    : libss-1.42.9-17.el7.x86_64                                                                                                                                                                                              24/26
  Cleanup    : libcom_err-1.42.9-17.el7.x86_64                                                                                                                                                                                         25/26
  Cleanup    : zlib-1.2.7-18.el7.x86_64                                                                                                                                                                                                26/26
  Verifying  : libselinux-devel-2.5-15.el7.x86_64                                                                                                                                                                                       1/26
  Verifying  : keyutils-libs-devel-1.5.8-3.el7.x86_64                                                                                                                                                                                   2/26
  Verifying  : pcre-devel-8.32-17.el7.x86_64                                                                                                                                                                                            3/26
  Verifying  : libkadm5-1.15.1-50.el7.x86_64                                                                                                                                                                                            4/26
  Verifying  : zlib-1.2.7-19.el7_9.x86_64                                                                                                                                                                                               5/26
  Verifying  : libverto-devel-0.2.5-4.el7.x86_64                                                                                                                                                                                        6/26
  Verifying  : libcom_err-1.42.9-19.el7.x86_64                                                                                                                                                                                          7/26
  Verifying  : 1:openssl-1.0.2k-21.el7_9.x86_64                                                                                                                                                                                         8/26
  Verifying  : e2fsprogs-libs-1.42.9-19.el7.x86_64                                                                                                                                                                                      9/26
  Verifying  : zlib-devel-1.2.7-19.el7_9.x86_64                                                                                                                                                                                        10/26
  Verifying  : libsepol-devel-2.5-10.el7.x86_64                                                                                                                                                                                        11/26
  Verifying  : 1:openssl-libs-1.0.2k-21.el7_9.x86_64                                                                                                                                                                                   12/26
  Verifying  : libss-1.42.9-19.el7.x86_64                                                                                                                                                                                              13/26
  Verifying  : 1:openssl-devel-1.0.2k-21.el7_9.x86_64                                                                                                                                                                                  14/26
  Verifying  : e2fsprogs-1.42.9-19.el7.x86_64                                                                                                                                                                                          15/26
  Verifying  : krb5-devel-1.15.1-50.el7.x86_64                                                                                                                                                                                         16/26
  Verifying  : krb5-libs-1.15.1-50.el7.x86_64                                                                                                                                                                                          17/26
  Verifying  : libcom_err-devel-1.42.9-19.el7.x86_64                                                                                                                                                                                   18/26
  Verifying  : e2fsprogs-libs-1.42.9-17.el7.x86_64                                                                                                                                                                                     19/26
  Verifying  : libcom_err-1.42.9-17.el7.x86_64                                                                                                                                                                                         20/26
  Verifying  : krb5-libs-1.15.1-46.el7.x86_64                                                                                                                                                                                          21/26
  Verifying  : 1:openssl-libs-1.0.2k-19.el7.x86_64                                                                                                                                                                                     22/26
  Verifying  : zlib-1.2.7-18.el7.x86_64                                                                                                                                                                                                23/26
  Verifying  : e2fsprogs-1.42.9-17.el7.x86_64                                                                                                                                                                                          24/26
  Verifying  : 1:openssl-1.0.2k-19.el7.x86_64                                                                                                                                                                                          25/26
  Verifying  : libss-1.42.9-17.el7.x86_64                                                                                                                                                                                              26/26

Installed:
  openssl-devel.x86_64 1:1.0.2k-21.el7_9                                            pcre-devel.x86_64 0:8.32-17.el7                                            zlib-devel.x86_64 0:1.2.7-19.el7_9

Dependency Installed:
  keyutils-libs-devel.x86_64 0:1.5.8-3.el7   krb5-devel.x86_64 0:1.15.1-50.el7   libcom_err-devel.x86_64 0:1.42.9-19.el7   libkadm5.x86_64 0:1.15.1-50.el7   libselinux-devel.x86_64 0:2.5-15.el7   libsepol-devel.x86_64 0:2.5-10.el7
  libverto-devel.x86_64 0:0.2.5-4.el7

Dependency Updated:
  e2fsprogs.x86_64 0:1.42.9-19.el7           e2fsprogs-libs.x86_64 0:1.42.9-19.el7      krb5-libs.x86_64 0:1.15.1-50.el7      libcom_err.x86_64 0:1.42.9-19.el7      libss.x86_64 0:1.42.9-19.el7      openssl.x86_64 1:1.0.2k-21.el7_9
  openssl-libs.x86_64 1:1.0.2k-21.el7_9      zlib.x86_64 0:1.2.7-19.el7_9

Complete!
[root@kernel-update ~]#

## Меняем нужный параметр configure в nginx.spec (версия сейчас уже не 1.1.1a, а 1.1.1k)

[root@kernel-update ~]# cd rpmbuild/SPECS/
[root@kernel-update SPECS]# sed -i "s/with-debug/with-openssl=\/root\/openssl-1.1.1k/g" nginx.spec

## Собираем пакет 

[root@kernel-update SPECS]# rpmbuild -bb nginx.spec
Выполняется(%prep): /bin/sh -e /var/tmp/rpm-tmp.PC4fP3
+ umask 022
+ cd /root/rpmbuild/BUILD
[skipped]
Записан: /root/rpmbuild/RPMS/x86_64/nginx-1.14.1-1.el7_4.ngx.x86_64.rpm
Записан: /root/rpmbuild/RPMS/x86_64/nginx-debuginfo-1.14.1-1.el7_4.ngx.x86_64.rpm
Выполняется(%clean): /bin/sh -e /var/tmp/rpm-tmp.OkBcHr
+ umask 022
+ cd /root/rpmbuild/BUILD
+ cd nginx-1.14.1
+ /usr/bin/rm -rf /root/rpmbuild/BUILDROOT/nginx-1.14.1-1.el7_4.ngx.x86_64
+ exit 0
[root@kernel-update SPECS]# cd ..
[root@kernel-update rpmbuild]# cd RPMS/x86_64/
[root@kernel-update x86_64]# ls
nginx-1.14.1-1.el7_4.ngx.x86_64.rpm  nginx-debuginfo-1.14.1-1.el7_4.ngx.x86_64.rpm
[root@kernel-update x86_64]#

## Устанавливаем и запускаем

[root@kernel-update x86_64]# rpm -i nginx-1.14.1-1.el7_4.ngx.x86_64.rpm
----------------------------------------------------------------------

Thanks for using nginx!

Please find the official documentation for nginx here:
* http://nginx.org/en/docs/

Please subscribe to nginx-announce mailing list to get
the most important news about nginx:
* http://nginx.org/en/support.html

Commercial subscriptions for nginx are available on:
* http://nginx.com/products/

----------------------------------------------------------------------
[root@kernel-update x86_64]# systemctl start nginx
[root@kernel-update x86_64]# systemctl status nginx
● nginx.service - nginx - high performance web server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)
   Active: active (running) since Пт 2021-05-28 15:32:34 UTC; 5s ago
     Docs: http://nginx.org/en/docs/
  Process: 21285 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)
 Main PID: 21286 (nginx)
   CGroup: /system.slice/nginx.service
           ├─21286 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
           └─21287 nginx: worker process

май 28 15:32:34 kernel-update systemd[1]: Starting nginx - high performance web server...
май 28 15:32:34 kernel-update systemd[1]: Started nginx - high performance web server.

## Создаем свой репозиторий и копируем туда созданный пакет и пакет percona-server

[root@kernel-update x86_64]# mkdir /usr/share/nginx/html/repo
[root@kernel-update x86_64]# cp nginx-1.14.1-1.el7_4.ngx.x86_64.rpm /usr/share/nginx/html/repo
[root@kernel-update x86_64]# cd /usr/share/nginx/html/repo
[root@kernel-update repo]# wget https://downloads.percona.com/downloads/percona-release/percona-release-0.1-6/redhat/percona-release-0.1-6.noarch.rpm
--2021-05-28 15:35:13--  https://downloads.percona.com/downloads/percona-release/percona-release-0.1-6/redhat/percona-release-0.1-6.noarch.rpm
Распознаётся downloads.percona.com (downloads.percona.com)... 162.220.4.221
Подключение к downloads.percona.com (downloads.percona.com)|162.220.4.221|:443... соединение установлено.
HTTP-запрос отправлен. Ожидание ответа... 200 OK
Длина: 14520 (14K) [application/x-redhat-package-manager]
Сохранение в: «percona-release-0.1-6.noarch.rpm»

100%[===================================================================================================================================================================================================>] 14 520      89,4KB/s   за 0,2s

2021-05-28 15:35:14 (89,4 KB/s) - «percona-release-0.1-6.noarch.rpm» сохранён [14520/14520]

[root@kernel-update repo]# ls
nginx-1.14.1-1.el7_4.ngx.x86_64.rpm  percona-release-0.1-6.noarch.rpm

[root@kernel-update repo]#  createrepo /usr/share/nginx/html/repo/
Spawning worker 0 with 1 pkgs
Spawning worker 1 with 1 pkgs
Workers Finished
Saving Primary metadata
Saving file lists metadata
Saving other metadata
Generating sqlite DBs
Sqlite DBs complete

## Добавляем параметр в конфиг nginx и перезапускаем его

[root@kernel-update repo]# sed -ie '/^        index/a autoindex on;' /etc/nginx/conf.d/default.conf
[root@kernel-update repo]# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
[root@kernel-update repo]# nginx -s reload

## Проверяем

[root@kernel-update repo]# curl -a http://localhost/repo/
<html>
<head><title>Index of /repo/</title></head>
<body bgcolor="white">
<h1>Index of /repo/</h1><hr><pre><a href="../">../</a>
<a href="repodata/">repodata/</a>                                          28-May-2021 15:36                   -
<a href="nginx-1.14.1-1.el7_4.ngx.x86_64.rpm">nginx-1.14.1-1.el7_4.ngx.x86_64.rpm</a>                28-May-2021 15:33             2004676
<a href="percona-release-0.1-6.noarch.rpm">percona-release-0.1-6.noarch.rpm</a>                   11-Nov-2020 21:48               14520
</pre><hr></body>
</html>

## Добавляем репозиторий в yum

[root@kernel-update repo]# cat >> /etc/yum.repos.d/otus.repo << EOF
> [otus]
> name=otus-linux
> baseurl=http://localhost/repo
> gpgcheck=0
> enabled=1
> EOF

## Проверяем и устанавливаем пакет

enabled=1
[root@kernel-update repo]# yum repolist enabled | grep otus
otus                                otus-linux                                 2
[root@kernel-update repo]# yum list | grep otus
percona-release.noarch                      0.1-6                      otus
[root@kernel-update repo]# yum install percona-release -y
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.logol.ru
 * extras: mirror.axelname.ru
 * updates: mirror.logol.ru
Resolving Dependencies
--> Running transaction check
---> Package percona-release.noarch 0:0.1-6 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=============================================================================================================================================================================================================================================
 Package                                                          Arch                                                    Version                                                Repository                                             Size
=============================================================================================================================================================================================================================================
Installing:
 percona-release                                                  noarch                                                  0.1-6                                                  otus                                                   14 k

Transaction Summary
=============================================================================================================================================================================================================================================
Install  1 Package

Total download size: 14 k
Installed size: 16 k
Downloading packages:
percona-release-0.1-6.noarch.rpm                                                                                                                                                                                      |  14 kB  00:00:00
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : percona-release-0.1-6.noarch                                                                                                                                                                                              1/1
  Verifying  : percona-release-0.1-6.noarch                                                                                                                                                                                              1/1

Installed:
  percona-release.noarch 0:0.1-6

Complete!

